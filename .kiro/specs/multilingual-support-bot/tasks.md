# 実装タスクリスト

## 概要

多言語対応問い合わせボットシステムの実装を、テスト駆動開発のアプローチで段階的に進めます。各タスクは前のタスクの成果物を基に構築され、最終的に統合されたシステムとして動作します。

## 実装タスク

- [x] 1. プロジェクト基盤とコア機能の実装

  - SAM CLIプロジェクトの初期化とTypeScript環境のセットアップ
  - 基本的なインターフェースとタイプ定義の実装
  - _要件: 1.1, 2.1, 8.1_

- [ ] 1.1 SAMプロジェクト構造とTypeScript環境をセットアップ
  - SAM CLIを使用してプロジェクトを初期化
  - ディレクトリ構造の作成（src/lambdas, src/types, src/utils, tests）
  - TypeScript設定ファイル（tsconfig.json）とビルド設定の実装
  - package.jsonの依存関係定義（AWS SDK v3, TypeScript, Jest等）
  - SAM template.yamlの基本構造を作成
  - _要件: 8.1_

- [ ] 1.2 コアインターフェースとタイプ定義を実装
  - src/types/index.tsにWebhookEvent、CommandResult、SessionLogインターフェースを定義
  - CommandTypeのenum定義と多言語コマンドマッピングオブジェクトを実装
  - エラーハンドリング用のカスタムエラークラスを作成
  - プラットフォーム別のペイロード型定義を実装
  - _要件: 2.1, 2.2, 2.5, 2.6_

- [ ] 1.3 ユーティリティ関数とヘルパークラスを実装
  - src/utils/languageDetector.tsで言語検出機能を実装（日本語/英語判定）
  - src/utils/sessionManager.tsでセッションID生成機能を実装
  - src/utils/piiMasker.tsでPIIマスキング機能を実装
  - ユニットテストを作成してユーティリティ関数の動作を検証
  - _要件: 2.5, 2.6, 8.5_

- [ ] 2. DynamoDBテーブル設計と基本操作の実装
  - DynamoDBテーブル定義とインデックス設計の実装
  - SessionManagerクラスの基本CRUD操作を実装
  - _要件: 3.1, 3.2, 3.4_

- [ ] 2.1 DynamoDBテーブル定義をSAMテンプレートで実装
  - SessionLogテーブルとKnowledgeVectorテーブルのCloudFormation定義
  - GSI（Global Secondary Index）とLSI（Local Secondary Index）の設定
  - TTL設定とオンデマンド課金モードの設定
  - _要件: 3.4, 7.2_

- [ ] 2.2 SessionManagerクラスの基本CRUD操作を実装
  - セッション作成、取得、更新、削除の基本メソッドを実装
  - セッションメタデータの管理機能を実装
  - TTL自動削除とクリア機能の実装
  - _要件: 3.1, 3.2, 3.3_

- [ ] 2.3 SessionManagerのユニットテストを作成
  - 各CRUD操作のテストケースを実装
  - エラーハンドリングのテストケースを実装
  - モックDynamoDBを使用したテスト環境の構築
  - _要件: 3.1, 3.2, 3.3_

- [ ] 3. ChatRouter Lambdaの実装
  - Webhookペイロード解析とコマンド識別機能の実装
  - プラットフォーム別パーサーの実装
  - _要件: 1.1, 1.2, 2.1, 2.2, 6.1, 6.2_

- [ ] 3.1 Webhookペイロード解析機能を実装
  - LINE、Slack、Teams各プラットフォームのペイロード解析クラスを実装
  - 署名検証機能の実装（セキュリティ要件対応）
  - プラットフォーム判定ロジックの実装
  - _要件: 1.1, 1.2, 8.1_

- [ ] 3.2 多言語コマンド識別機能を実装
  - コマンドマッピング辞書の実装（日本語/英語対応）
  - コマンド解析ロジックの実装
  - 言語検出機能の実装
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6_

- [ ] 3.3 ChatRouter Lambdaのメイン処理を実装
  - Lambda handlerの実装
  - セッション管理との連携実装
  - 即時ACK応答の実装（100ms以内）
  - EventBridgeイベント発行機能の実装
  - _要件: 1.3, 3.1, 6.1, 6.2_

- [ ] 3.4 ChatRouter Lambdaのユニットテストを作成
  - 各プラットフォームのペイロード解析テスト
  - コマンド識別機能のテスト
  - エラーハンドリングのテスト
  - パフォーマンステスト（レスポンス時間測定）
  - _要件: 1.1, 1.2, 2.1, 2.2, 6.1, 6.2_

- [ ] 4. ベクター検索機能の実装
  - MiniLMベクター生成機能の実装
  - DynamoDB Vector Search機能の実装
  - _要件: 4.1, 4.2, 4.5_

- [ ] 4.1 ベクター生成機能を実装
  - MiniLMモデルを使用したテキストベクター化機能の実装
  - バッチ処理対応のベクター生成機能の実装
  - ベクター正規化とコサイン類似度計算機能の実装
  - _要件: 4.5_

- [ ] 4.2 VectorSearchServiceクラスを実装
  - DynamoDB Vector Search機能の実装
  - 類似度閾値による結果フィルタリング機能の実装
  - 検索結果のランキング機能の実装
  - _要件: 4.1, 4.2, 4.5_

- [ ] 4.3 KnowledgeVectorテーブルのデータ投入機能を実装
  - ドキュメントからのベクター生成とDynamoDB投入機能
  - GitHub Issuesからのベクター生成機能
  - 会話履歴からのベクター生成機能
  - _要件: 4.1, 4.2_

- [ ] 4.4 ベクター検索機能のユニットテストを作成
  - ベクター生成機能のテスト
  - 類似度計算のテスト
  - 検索結果ランキングのテスト
  - パフォーマンステスト（10-20ms以内の検索時間）
  - _要件: 4.5_

- [ ] 5. Clarify Lambda（ヒアリング機能）の実装
  - 不足情報検出機能の実装
  - 質問生成機能の実装
  - _要件: 4.3_

- [ ] 5.1 不足情報スキーマとテンプレート機能を実装
  - YAML形式の不足情報スキーマの定義
  - 質問テンプレートの多言語対応実装
  - スキーマ読み込みと解析機能の実装
  - _要件: 2.5, 2.6_

- [ ] 5.2 ClarifyLambdaのメイン処理を実装
  - 会話履歴分析による不足情報検出ロジック
  - LLMを使用した情報充足度判定機能
  - 次の質問生成機能の実装
  - ヒアリング完了判定機能の実装
  - _要件: 4.3_

- [ ] 5.3 ClarifyLambdaのユニットテストを作成
  - 不足情報検出ロジックのテスト
  - 質問生成機能のテスト
  - 多言語対応のテスト
  - ヒアリング完了判定のテスト
  - _要件: 2.5, 2.6, 4.3_

- [ ] 6. Retrieve Lambda（検索機能）の実装
  - GitHub API連携機能の実装
  - ドキュメント検索機能の実装
  - _要件: 4.1, 4.2, 4.3_

- [ ] 6.1 GitHub API連携機能を実装
  - GitHub App認証機能の実装
  - Issues検索機能の実装
  - Pull Requests検索機能の実装
  - 検索結果の正規化機能の実装
  - _要件: 4.1, 8.2_

- [ ] 6.2 ドキュメント検索機能を実装
  - 外部ドキュメントソースからの検索機能
  - 検索結果の統合とランキング機能
  - メタデータ抽出機能の実装
  - _要件: 4.2_

- [ ] 6.3 RetrieveLambdaのメイン処理を実装
  - 並列検索処理の実装（GitHub、ドキュメント、会話履歴）
  - 検索結果の統合とスコアリング機能
  - 最新50件の会話履歴検索機能
  - _要件: 4.1, 4.2, 4.4_

- [ ] 6.4 RetrieveLambdaのユニットテストを作成
  - GitHub API連携のテスト
  - ドキュメント検索のテスト
  - 検索結果統合のテスト
  - パフォーマンステスト
  - _要件: 4.1, 4.2, 4.4_

- [ ] 7. DecideAction Lambda（AI回答生成）の実装
  - Bedrock Claude 3.5 Haiku連携機能の実装
  - 回答生成とGitHub操作判定機能の実装
  - _要件: 4.3, 5.1, 5.2, 5.3, 5.4_

- [ ] 7.1 Bedrock Claude 3.5 Haiku連携機能を実装
  - Bedrock APIクライアントの実装
  - プロンプトテンプレート機能の実装（日本語/英語対応）
  - AI応答の解析と構造化機能の実装
  - _要件: 2.5, 2.6, 4.3, 7.3_

- [ ] 7.2 回答生成ロジックを実装
  - 検索結果と会話履歴を基にした回答生成機能
  - 回答品質評価機能の実装
  - 信頼度スコア計算機能の実装
  - _要件: 4.3_

- [ ] 7.3 GitHub操作判定機能を実装
  - Issue作成判定ロジックの実装
  - PR作成判定ロジックの実装
  - GitHub操作実行機能の実装
  - _要件: 5.1, 5.2, 5.3, 5.4_

- [ ] 7.4 DecideActionLambdaのユニットテストを作成
  - AI回答生成のテスト
  - GitHub操作判定のテスト
  - 多言語対応のテスト
  - エラーハンドリングのテスト
  - _要件: 2.5, 2.6, 4.3, 5.1, 5.2_

- [ ] 8. Step Functions ワークフロー実装
  - ヒアリング型ワークフローの実装
  - Callback機能とタイムアウト処理の実装
  - _要件: 3.1, 3.2, 3.3, 4.3, 6.3_

- [ ] 8.1 Step Functions State Machine定義を実装
  - ヒアリング型ワークフローのState Machine定義
  - Choice、Task、Parallel、Waitステートの実装
  - エラーハンドリングとリトライ設定の実装
  - _要件: 3.1, 3.2, 4.3_

- [ ] 8.2 Callback機能とTaskToken管理を実装
  - Step Functions Callback機能の実装
  - TaskTokenの管理とセッション連携機能
  - タイムアウト処理とエラーハンドリングの実装
  - _要件: 3.2, 6.3_

- [ ] 8.3 Step Functionsワークフローのテストを作成
  - ワークフロー全体の統合テスト
  - Callback機能のテスト
  - タイムアウト処理のテスト
  - エラーハンドリングのテスト
  - _要件: 3.1, 3.2, 3.3, 6.3_

- [ ] 9. Notifier Lambda（通知機能）の実装
  - プラットフォーム別通知機能の実装
  - メッセージフォーマット機能の実装
  - _要件: 1.3, 2.5, 2.6_

- [ ] 9.1 プラットフォーム別通知機能を実装
  - LINE Bot API連携機能の実装
  - Slack API連携機能の実装
  - Microsoft Teams API連携機能の実装
  - _要件: 1.1, 1.2, 1.3_

- [ ] 9.2 メッセージフォーマット機能を実装
  - 多言語メッセージテンプレート機能
  - マークダウン形式対応機能
  - コードブロック整形機能
  - _要件: 2.5, 2.6_

- [ ] 9.3 NotifierLambdaのユニットテストを作成
  - 各プラットフォーム通知のテスト
  - メッセージフォーマットのテスト
  - エラーハンドリングのテスト
  - _要件: 1.1, 1.2, 1.3, 2.5, 2.6_

- [ ] 10. Summarize Lambda（要約機能）の実装
  - セッション要約機能の実装
  - ベクター更新機能の実装
  - _要件: 3.3, 4.4_

- [ ] 10.1 セッション要約機能を実装
  - 会話履歴の要約生成機能
  - 重要ポイント抽出機能
  - 要約のベクター化機能
  - _要件: 3.3, 4.4_

- [ ] 10.2 ベクター更新機能を実装
  - 会話履歴のベクター生成と保存機能
  - KnowledgeVectorテーブルへの更新機能
  - 重複排除とマージ機能
  - _要件: 4.4_

- [ ] 10.3 SummarizeLambdaのユニットテストを作成
  - 要約生成機能のテスト
  - ベクター更新機能のテスト
  - エラーハンドリングのテスト
  - _要件: 3.3, 4.4_

- [ ] 11. API Gateway設定とセキュリティ実装
  - HTTP API設定とWebhookエンドポイントの実装
  - レート制限とセキュリティ機能の実装
  - _要件: 1.1, 1.2, 6.1, 6.2, 8.1, 8.4_

- [ ] 11.1 API Gateway HTTP API設定を実装
  - Webhookエンドポイントの設定
  - CORS設定とHTTPSリダイレクト設定
  - ログ設定とメトリクス設定
  - _要件: 1.1, 1.2, 6.1, 6.2_

- [ ] 11.2 レート制限とセキュリティ機能を実装
  - Usage Planとレート制限の設定
  - WAF設定とDDoS保護機能
  - IP制限とアクセス制御機能
  - _要件: 8.4_

- [ ] 11.3 Secrets Manager連携を実装
  - プラットフォーム別トークン管理機能
  - GitHub App認証情報管理機能
  - 認証情報の自動ローテーション設定
  - _要件: 8.1, 8.5_

- [ ] 12. 監視・ログ・アラート機能の実装
  - CloudWatch監視機能の実装
  - エラー追跡とアラート機能の実装
  - _要件: 6.3, 6.4, 8.3_

- [ ] 12.1 CloudWatch監視機能を実装
  - カスタムメトリクスの実装
  - ダッシュボード設定の実装
  - ログ集約とフィルタリング機能
  - _要件: 6.3, 6.4, 8.3_

- [ ] 12.2 エラー追跡とアラート機能を実装
  - CloudWatch Alarmsの設定
  - SNS通知機能の実装
  - エラー分析とレポート機能
  - _要件: 8.3_

- [ ] 12.3 コスト監視機能を実装
  - AWS Cost Explorer連携機能
  - 月次コスト分析機能
  - 予算アラート機能
  - _要件: 7.1, 8.3_

- [ ] 13. E2Eテストとデプロイメント準備
  - 統合テストの実装
  - デプロイメント設定の実装
  - _要件: 全要件の統合テスト_

- [ ] 13.1 E2Eテストスイートを実装
  - プラットフォーム別のE2Eテスト
  - ヒアリング型フローのE2Eテスト
  - パフォーマンステストの実装
  - _要件: 1.1, 1.2, 2.1-2.6, 3.1-3.4, 4.1-4.5, 6.1-6.4_

- [ ] 13.2 SAMデプロイメント設定を実装
  - 環境別設定ファイルの作成
  - CI/CDパイプライン設定
  - ロールバック機能の実装
  - _要件: 8.1_

- [ ] 13.3 本番環境デプロイメントとヘルスチェック
  - 本番環境へのデプロイメント実行
  - ヘルスチェックとスモークテストの実行
  - 監視機能の動作確認
  - _要件: 全要件の本番環境での動作確認_

- [ ] 14. ドキュメント作成と運用準備
  - 運用マニュアルの作成
  - トラブルシューティングガイドの作成
  - _要件: 運用・保守要件_

- [ ] 14.1 運用マニュアルを作成
  - システム構成図と運用手順書
  - 監視項目とアラート対応手順
  - バックアップとリストア手順
  - _要件: 運用要件_

- [ ] 14.2 トラブルシューティングガイドを作成
  - よくある問題と解決方法
  - ログ分析手順
  - エスカレーション手順
  - _要件: 運用要件_